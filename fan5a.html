<html lang="en">
<head>
 <meta charset="utf-8">
 <title>FRED-powered chat app</title>
 <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
 <script src="http:///code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
</head>
<body>
 
 <script type="text/javascript">

 // Open a websocket using FRED.
 var wsUri="ws://"+window.location.hostname+":1880/ws/faner";
	//var wsUri="ws://"+window.location.hostname+":1880/ws/mobiui";
 var ws;
 var fan_state;	
 function chv(n,n1,n2,n3,tm){
    const rg = (s,l)=>s.substr(s.length-l);
    const zr = (n)=>rg('0'+n,2);
    const dt = (t)=>t?new Date(parseInt(t)):null; 
    const tmstr =(d)=>d?(""+ zr(d.getHours())+":"+  zr(d.getMinutes())):"";
    const tms = tmstr(dt(tm));

    console.log(n);
    fan_state = n2;
    console.log(fan_state);
    console.log(n2);
    const apl=(cnt,pfx, s0, s1)=>
        Array(cnt).fill(true).forEach( (e,i,a) =>  
            document.getElementById(pfx+i).style.cssText =
                ((i==s0)?'border-color: rgb(252, 29, 29); border-width:0 ; fill: red; stroke: red;':
                 (!!s1&&i==s1)?'border-color: rgb(29, 200, 50); border-width: 0; fill:  rgb(29, 200, 50) ; stroke:  rgb(29, 200, 50) ;':
                'border-color: rgb(231, 231, 227); border-width: 0 ;fill:  rgb(218, 218, 218) ; stroke:  rgb(218, 218, 218) ;'
            ));

    apl(10,'s', n, n1);
    //apl(4 ,'f', n2, n3);
    //apl(3 ,'fn', n2, n3);
    Array(3).fill(true).forEach(  (e,i,a) => {
                console.log(i);
                console.log(document.getElementById('fn'+i));
                document.getElementById("fn"+i).style.cssText =
                    i==1&&(n2==1||n2==3)//YELOW
                        ? 'fill: rgb(250, 200, 50); stroke: rgb(250, 200, 50);'
                        : n2==2||(i==0&&n2==1)||(i==2&&n2==3)
                            ? 'fill: red; stroke: red;'
                            : 'fill: rgb(100, 100, 120); stroke: rgb(100, 100, 120); '; 
                console.log(document.getElementById('fn'+i).style.cssTex);
            }
        );
        document.getElementById("tm").innerHTML=tms;    
    return  null;
 }
 const toIdx=(n,i)=>i.search(n.toString()) ;
 const lval=(o,p)=>p.split('/').reduce((a,v)=>a[v],o);

 
 function wsConn() {
		ws = new WebSocket(wsUri);
		ws.onmessage = function(m) {
            const fl=(d)=>toIdx(lval(d,'faner/light'),lval(d,'faner/lightIdx'));
            const flt=(d)=>lval(d,'faner/lightTo');
            const ff=(d)=>toIdx(lval(d,'faner/fan'),lval(d,'faner/fanIdx'));
            const fft=(d)=>lval(d,'faner/fanTo');
            const frn=(d)=>chv(fl(d),flt(d),ff(d),fft(d), lval(d,'faner/timeExt'));
            console.log('< from-node-red:',m.data);
            frn(JSON.parse(m.data));
            
        }
        ws.onopen = function() { 
			var obj = {"payload":'tap',"topic":'faner/lightTo'};
			getRequest = JSON.stringify(obj); 	
			ws.send(getRequest);			// Request ui status from NR
			console.log("sent init requeset");
		}
		ws.onclose   = function()  {
			console.log('Node-RED connection closed: '+new Date().toUTCString()); 
			connected = false; 
			ws = null;
			setTimeout(wsConn, 10000);
		}	
		ws.onerror  = function(){
			console.log("connection error");
		}
    }
    wsConn();
    const f=(x)=> ws.send(JSON.stringify({ "payload":x,"topic":'faner/lightTo'}));
    const f2=(x)=> ws.send(JSON.stringify({ "payload":x,"topic":'faner/fanTo'}));
    const f2_3 = (k,cur)=> Number.parseInt( ['1032','2000','3210'][k][cur]);
    const f2_1 = (k)=>f2(f2_3(k,fan_state)) ;

 </script>

 <style>
    body {
       background-color: rgb(0, 0, 0);
    }

    td{
        
    
        background-color: black;
        width :15%;
    }

    td > div {
        /* background-color: rgba(231, 231, 227, 0.877); */
        border-color: rgb(231, 231, 227);
        border-style: solid;
        border-width: 10px;
        width: 50%;
        height: 50%; 
        margin: 10px auto;
        padding: 40px; 
        border-radius: 20px;
        stroke:  rgb(218, 218, 218);
        fill:   rgb(218, 218, 218);
    }

    #tm
    {
        font-size: 40px;
        font-family: Verdana;
        color: red;
    } 

  

    .m-con{
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        flex-wrap: nowrap;
        justify-content: space-around;
        align-items: stretch;
    }
    .but-b{

        /* height: 50%; */
        width: 100%;
    
    }

    
    .but-h{
        display: flex;
        flex-direction: row;
        justify-content: space-around;
       
    }
    
    .but-s{
      /* height: 30px; */
      width: 100%;
    }
    .but{
        background-color:rgb(20, 13, 34);
        border-radius: 5vmin;
        border-color: rgb(112, 159, 200);
        
        margin: 0.6vh;
        height: 100%;
        width: 100%;
        border: 1vmin solid #878999;
        stroke:  rgb(218, 218, 218);
        
        fill:   rgb(218, 218, 218);
        vertical-align: center;
        padding-left: 3vw;
        padding-right: 3vw;
        padding-top: 1vw;
        padding-bottom: 1vw;

        display: flex;
       
        flex-direction: column;
        align-items: center;
   
        cursor: pointer;
        justify-content: space-around;
    }
    .r1-con, .r2-con, .r3-con{
        display: flex;
        flex-direction: row;   
        flex-wrap: nowrap;
        justify-content: space-around; 
        align-items: center;
        margin: 0.6vh;

    }
    .r1-con{height: 33% }
    .r2-con{height: 33%;} 
    .r3-con{height: 13%;}
    /* .r2-con{
        display: flex;
        flex-direction: row;   
        flex-wrap: nowrap;
        justify-content: space-around; 
        align-items: center;
        height: 100%;
    
    } */

</style>

<div class="m-con">
    <div class="r1-con" id = "cvDiv"  >
        
        <span class="but-h"  >    
            <div class = "cnt" id = "cvDiv1"  onClick="window.location.reload();">
                <canvas id="testCanvas" ></canvas>
            </div >
            
        </span>
    </div>
    <div class="r2-con">
        <span onclick=f(0) class="but" id='s0'>
            <svg  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18H15"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10 21H14"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16.4999 11.5C17.4997 10.5 17.9765 9.48689 17.9999 8C18.0479 4.95029 16 3 11.9999 3C10.8324 3 9.83119 3.16613 8.99988 3.47724"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8.99985 15C9 13 8.5 12.5 7.49985 11.5C6.4997 10.5 6.02324 9.48689 5.99985 8C5.99142 7.46458 6.0476 6.96304 6.1676 6.5"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3 3L21 21"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
        </span>
        <span class="but">
            <div onclick=f(1) class="but-b" id='s1'>
                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                viewBox="0 0 209.458 209.458" style="enable-background:new 0 0 209.458 209.458;" xml:space="preserve">
                        <g>
                            <path d="M104.729,88.167c6.095,0,11.041-4.946,11.041-11.041V55.044c0-6.095-4.946-11.041-11.041-11.041
                                c-6.1,0-11.041,4.946-11.041,11.041v22.082C93.688,83.221,98.629,88.167,104.729,88.167z M34.458,101.66L18.846,86.042
                                c-4.312-4.312-11.301-4.312-15.612,0c-4.312,4.312-4.312,11.301,0,15.618l15.612,15.618c2.159,2.159,4.98,3.235,7.806,3.235
                                s5.648-1.077,7.806-3.23C38.775,112.96,38.775,105.971,34.458,101.66z M104.729,110.249c-27.443,0-53.058,14.801-66.865,38.633
                                c-1.976,3.417-1.982,7.624-0.011,11.047c1.965,3.417,5.614,5.526,9.562,5.526h114.629c3.947,0,7.596-2.109,9.567-5.526
                                c1.971-3.423,1.965-7.629-0.011-11.047C157.787,125.05,132.172,110.249,104.729,110.249z M71.716,143.373
                                c9.407-7.039,20.967-11.041,33.013-11.041s23.6,4.002,33.007,11.041H71.716z M206.224,86.042
                                c-4.312-4.306-11.301-4.312-15.612,0L175,101.66c-4.312,4.312-4.312,11.301,0,15.618c2.159,2.153,4.98,3.23,7.806,3.23
                                c2.827,0,5.648-1.077,7.806-3.235l15.612-15.618C210.536,97.342,210.536,90.353,206.224,86.042z"/>
                        </g>
                </svg>
            </div>
            <div onclick=f(9) class= "but-s" id='s9'>
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 240 240" style="enable-background:new 0 0 240 240;" xml:space="preserve">
                    <g>
                            <path d="M 6.6883778,200 35.827905,46.351351 H 199.00927 v 0 L 228.1488,200 H 117.41859 v -11.81912 l -5.82791,-43.3368 V 97.567569 h 81.59068 L 187.35344,54.23077 H 47.483717 L 41.655812,97.567569 H 117.41859 L 115,145 l 2.41859,43.18088 V 200 Z"
                    </g>
                  </svg>
            </div>
        </span>

        <span class="but">
            <div onclick=f(2) class="but-b" id='s2' >
                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        viewBox="0 0 287.068 287.068" style="enable-background:new 0 0 287.068 287.068;" xml:space="preserve">
                        <g>
                        <g id="Dibujo_2_">
                            <path d="M33.123,198.74H11.041C4.941,198.74,0,203.686,0,209.781s4.941,11.041,11.041,11.041h22.082
                                c6.095,0,11.041-4.946,11.041-11.041S39.218,198.74,33.123,198.74z M143.534,110.411c6.095,0,11.041-4.946,11.041-11.041V77.288
                                c0-6.095-4.946-11.041-11.041-11.041c-6.1,0-11.041,4.946-11.041,11.041V99.37C132.493,105.465,137.434,110.411,143.534,110.411z
                                M73.263,123.903l-15.612-15.618c-4.312-4.312-11.301-4.312-15.612,0c-4.312,4.312-4.312,11.301,0,15.618l15.612,15.618
                                c2.159,2.159,4.98,3.235,7.806,3.235c2.827,0,5.648-1.076,7.806-3.23C77.58,135.204,77.58,128.215,73.263,123.903z
                                M276.027,198.74h-22.082c-6.1,0-11.041,4.946-11.041,11.041s4.941,11.041,11.041,11.041h22.082
                                c6.095,0,11.041-4.946,11.041-11.041S282.122,198.74,276.027,198.74z M143.534,132.493c-42.619,0-77.288,34.669-77.288,77.288
                                c0,6.095,4.941,11.041,11.041,11.041h132.493c6.095,0,11.041-4.946,11.041-11.041
                                C220.822,167.162,186.153,132.493,143.534,132.493z M89.438,198.74c5.129-25.168,27.437-44.164,54.096-44.164
                                s48.967,18.996,54.096,44.164H89.438z M245.03,108.286c-4.312-4.306-11.301-4.312-15.612,0l-15.612,15.618
                                c-4.312,4.312-4.312,11.301,0,15.618c2.159,2.153,4.98,3.23,7.806,3.23s5.648-1.077,7.806-3.235l15.612-15.618
                                C249.341,119.586,249.341,112.597,245.03,108.286z"/>
                        </g>
                    </g>
                </svg>
            </div>
            <div onclick=f(8) class= "but-s" id='s8'>
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  viewBox="0 0 240 240" style="enable-background:new 0 0 240 240;" xml:space="preserve">
                    <g>
                            <path d="M 6.6883778,200 35.827905,46.351351 H 199.00927 v 0 L 228.1488,200 H 117.41859 V 188.18088 L 111.59068,144.84408 115,145 h 90 L 187.35344,54.23077 H 47.483717 L 30,145 h 85 v 0 l 2.41859,43.18088 V 200 Z"/>
                        
                    </g>
                </svg>
            </div>
        </span>
        <span class="but">
            <div onclick=f(3) class="but-b" id='s3'>
                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    viewBox="0 0 287.068 287.068" style="enable-background:new 0 0 287.068 287.068;" xml:space="preserve">
                    <g>
                        <g id="Dibujo_1_">
                            <path d="M73.263,107.342L57.651,91.724c-4.312-4.312-11.301-4.312-15.612,0c-4.312,4.312-4.312,11.301,0,15.618l15.612,15.618
                                c2.159,2.159,4.98,3.235,7.806,3.235c2.827,0,5.648-1.077,7.806-3.23C77.58,118.642,77.58,111.653,73.263,107.342z
                                    M143.534,93.849c6.095,0,11.041-4.946,11.041-11.041V60.726c0-6.095-4.946-11.041-11.041-11.041
                                c-6.1,0-11.041,4.946-11.041,11.041v22.082C132.493,88.903,137.434,93.849,143.534,93.849z M33.123,182.178H11.041
                                C4.946,182.178,0,187.124,0,193.219s4.946,11.041,11.041,11.041h22.082c6.095,0,11.041-4.946,11.041-11.041
                                S39.218,182.178,33.123,182.178z M276.027,182.178h-22.082c-6.095,0-11.041,4.946-11.041,11.041s4.946,11.041,11.041,11.041
                                h22.082c6.095,0,11.041-4.946,11.041-11.041S282.122,182.178,276.027,182.178z M245.03,91.724c-4.312-4.306-11.301-4.312-15.612,0
                                l-15.612,15.618c-4.312,4.312-4.312,11.301,0,15.618c2.159,2.153,4.98,3.23,7.806,3.23s5.648-1.077,7.806-3.235l15.612-15.618
                                C249.341,103.024,249.341,96.035,245.03,91.724z M143.534,115.932c-42.619,0-77.288,34.669-77.288,77.288
                                c0,13.525,3.599,26.891,10.423,38.655c1.971,3.412,5.609,5.51,9.551,5.51h114.629c3.942,0,7.58-2.098,9.551-5.51
                                c6.823-11.764,10.423-25.13,10.423-38.655C220.822,150.601,186.153,115.932,143.534,115.932z M194.086,215.301H92.983
                                c-3.058-6.961-4.654-14.491-4.654-22.082c0-30.44,24.765-55.205,55.205-55.205s55.205,24.765,55.205,55.205
                                C198.74,200.81,197.144,208.34,194.086,215.301z"/>
                        </g>
                    </g>
              
               </svg>
            </div>
            <div onclick=f(7) class= "but-s" id='s7'>
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 240 240" style="enable-background:new 0 0 240 240;" xml:space="preserve">
                    <g>
                            <path d="M 6.6883778,200 35.827905,46.351351 H 199.00927 v 0 L 228.1488,200 H 117.41859 v -11.81912 h 93.24648 l -5.8279,-43.3368 H 111.59068 V 97.567569 h 81.59068 L 187.35344,54.23077 H 47.483717 l -5.827905,43.336799 h 75.762778 l -5.82791,47.276511 H 30 l -5.827905,43.3368 H 117.41859 V 200 Z"/>
                        </g>
                  </svg>
            </div>
        </span>
        <span class="but">
            <div onclick=f(4) class="but-b" id='s4'>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                    <g>
                        <path d="M256,121c-74.439,0-135,60.561-135,135s60.561,135,135,135s135-60.561,135-135S330.439,121,256,121z M256,361   c-57.897,0-105-47.103-105-105s47.103-105,105-105s105,47.103,105,105S313.897,361,256,361z"/>
                        <path d="M256,91c8.284,0,15-6.716,15-15V15c0-8.284-6.716-15-15-15s-15,6.716-15,15v61C241,84.284,247.716,91,256,91z"/>
                        <path d="M256,421c-8.284,0-15,6.716-15,15v61c0,8.284,6.716,15,15,15s15-6.716,15-15v-61C271,427.716,264.284,421,256,421z"/>
                        <path d="M173.259,95.442c3.171,7.655,11.947,11.288,19.599,8.118c7.653-3.17,11.288-11.945,8.118-19.598l-11.48-27.716   c-3.17-7.654-11.945-11.288-19.599-8.118s-11.288,11.945-8.118,19.598L173.259,95.442z"/>
                        <path d="M338.741,416.558c-3.17-7.654-11.945-11.287-19.599-8.118c-7.653,3.17-11.288,11.945-8.118,19.599l11.48,27.716   c3.17,7.655,11.945,11.288,19.599,8.118c7.653-3.17,11.288-11.945,8.118-19.599L338.741,416.558z"/>
                        <path d="M319.143,103.56c7.654,3.171,16.429-0.466,19.599-8.118l11.48-27.716c3.17-7.654-0.465-16.428-8.118-19.598   c-7.652-3.17-16.429,0.464-19.599,8.118l-11.48,27.716C307.854,91.615,311.489,100.39,319.143,103.56z"/>
                        <path d="M192.857,408.44c-7.653-3.169-16.428,0.464-19.599,8.118l-11.48,27.716c-3.17,7.654,0.465,16.428,8.118,19.599   c7.656,3.171,16.43-0.467,19.599-8.118l11.48-27.716C204.146,420.385,200.511,411.61,192.857,408.44z"/>
                        <path d="M91,256c0-8.284-6.716-15-15-15H15c-8.284,0-15,6.716-15,15s6.716,15,15,15h61C84.284,271,91,264.284,91,256z"/>
                        <path d="M497,241h-61c-8.284,0-15,6.716-15,15s6.716,15,15,15h61c8.284,0,15-6.716,15-15S505.284,241,497,241z"/>
                        <path d="M118.114,139.327c5.857,5.858,15.355,5.858,21.213,0c5.858-5.858,5.858-15.355,0-21.213L96.9,75.688   c-5.857-5.858-15.355-5.858-21.213,0c-5.858,5.858-5.858,15.355,0,21.213L118.114,139.327z"/>
                        <path d="M393.886,372.673c-5.857-5.858-15.355-5.858-21.213,0c-5.858,5.858-5.858,15.355,0,21.213l42.427,42.426   c5.857,5.858,15.356,5.858,21.213,0c5.858-5.858,5.858-15.355,0-21.213L393.886,372.673z"/>
                        <path d="M118.114,372.673l-42.427,42.426c-5.858,5.857-5.858,15.355,0,21.213c5.857,5.858,15.355,5.858,21.213,0l42.427-42.426   c5.858-5.857,5.858-15.355,0-21.213C133.47,366.815,123.972,366.815,118.114,372.673z"/>
                        <path d="M393.886,139.327l42.427-42.426c5.858-5.858,5.858-15.355,0-21.213c-5.856-5.858-15.354-5.858-21.213,0l-42.427,42.426   c-5.858,5.858-5.858,15.355,0,21.213C378.529,145.185,388.027,145.185,393.886,139.327z"/>
                        <path d="M103.561,319.143c-3.17-7.654-11.945-11.288-19.599-8.118l-27.717,11.48c-7.653,3.17-11.288,11.945-8.118,19.598   c3.171,7.655,11.947,11.288,19.599,8.118l27.717-11.48C103.096,335.571,106.73,326.797,103.561,319.143z"/>
                        <path d="M408.439,192.857c3.171,7.655,11.947,11.288,19.599,8.118l27.717-11.48c7.653-3.17,11.288-11.945,8.118-19.598   s-11.946-11.288-19.599-8.118l-27.717,11.48C408.904,176.429,405.27,185.203,408.439,192.857z"/>
                        <path d="M455.755,322.505l-27.717-11.48c-7.656-3.171-16.429,0.464-19.599,8.118s0.465,16.428,8.118,19.598l27.717,11.48   c7.658,3.172,16.43-0.468,19.599-8.118C467.043,334.45,463.408,325.676,455.755,322.505z"/>
                        <path d="M56.245,189.495l27.717,11.48c7.657,3.172,16.43-0.468,19.599-8.118c3.17-7.654-0.465-16.428-8.118-19.598l-27.717-11.48   c-7.656-3.171-16.429,0.464-19.599,8.118S48.592,186.324,56.245,189.495z"/>
                    </g>
                </svg>
            </div>
            <div onclick=f(6) class= "but-s" id='s6'>
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 240 240" style="enable-background:new 0 0 240 240;" xml:space="preserve">
                    <g>
                           <path d="M 6.6883778,200 35.827905,46.351351 H 199.00927 v 0 L 228.1488,200 H 117.41859 v -11.81912 h 93.24648 L 195,100 h -85 l 1.59068,-2.432431 h 81.59068 -75.76277 L 115,100 H 40 L 24.172095,188.18088 H 117.41859 V 200 Z"/>
                    </g>
                  </svg>
       
            </div>
        </span>
        <span onclick=f(5) class="but" id='s5'>
            <svg  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18H15"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 21H14"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16.4999 11.5C17.4997 10.5 17.9765 9.48689 17.9999 8C18.0479 4.95029 16 3 11.9999 3C10.8324 3 9.83119 3.16613 8.99988 3.47724"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8.99985 15C9 13 8.5 12.5 7.49985 11.5C6.4997 10.5 6.02324 9.48689 5.99985 8C5.99142 7.46458 6.0476 6.96304 6.1676 6.5"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 3L21 21"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </span>
    </div>
    <div class="r3-con">
        <span onclick=f2_1(0) class="but" id='fn0'>
            <svg width="40%" viewBox="0 -17 511.99979 511"  xmlns="http://www.w3.org/2000/svg"><path d="m506.078125 308.792969-2.558594-7.90625-48.820312-12.226563c.300781-4.429687.4375-8.875.4375-13.363281 0-56.921875-24.449219-111.230469-67.074219-149.003906l-19.890625 22.441406c36.214844 32.085937 56.976563 78.21875 56.976563 126.5625 0 1.988281-.027344 3.96875-.109376 5.9375l-31.699218-7.9375c-.449219-31.117187-11.523438-61.335937-31.324219-85.328125l-23.132813 19.09375c13.753907 16.652344 22.121094 37.183594 24.0625 58.625l-32.308593-8.085938c-3.488281-14.734374-11.257813-27.839843-21.914063-37.925781l49.121094-171.363281-5.554688-6.167969c-23.8125-26.460937-58.878906-41.644531-96.195312-41.644531s-72.371094 15.183594-96.183594 41.644531l-5.558594 6.167969 13.847657 48.320312c-10.867188 5.367188-21.304688 11.765626-31.199219 19.171876-33.4375 25-58.648438 60.628906-70.992188 100.304687l28.636719 8.90625c13.625-43.824219 43.542969-78.78125 81.941407-99.125l9.054687 31.609375c-11.796875 7.058594-22.589844 15.902344-31.925781 26.351562l22.359375 19.980469c5.476562-6.128906 11.597656-11.554687 18.203125-16.195312l9.1875 32.050781c-10.597656 10.035156-18.34375 23.058594-21.851563 37.703125l-32.339843 8.007813c1.109374-12.382813 4.339843-24.320313 9.648437-35.617188l-27.152344-12.742188c-8.253906 17.589844-12.601562 36.382813-12.921875 55.886719l-110.238281 27.289063-2.582031 7.898437c-11.074219 33.835938-6.753906 71.792969 11.847656 104.148438 18.601562 32.347656 49.230469 55.179687 84.039062 62.636719l8.125 1.738281 35.039063-36.132813c32.636719 21.949219 71.230469 33.824219 111.015625 33.824219 13.734375 0 27.449219-1.398437 40.773438-4.175781l-6.117188-29.359375c-11.316406 2.359375-22.96875 3.546875-34.65625 3.546875-32.6875 0-63.527344-9.433594-89.675781-25.859375l22.691406-23.402344c19.824219 11.136719 42.675781 17.484375 66.984375 17.484375v-29.988281c-16.132812 0-31.4375-3.578125-45.171875-9.996094l23.171875-23.910156c6.964844 2.097656 14.351562 3.226562 22 3.226562 7.578125 0 14.894531-1.097656 21.8125-3.167969l123.703125 128.300782 8.125-1.71875c34.828125-7.355469 65.527344-30.109375 84.210937-62.40625 18.691407-32.296875 23.109376-70.242188 12.132813-104.109375zm-200.761719 25.148437c13.464844-11.3125 23-27.167968 26.207032-45.203125l148.175781 37.097657c5.40625 23.75 1.289062 49.582031-11.707031 72.050781-13.003907 22.464843-33.335938 38.90625-56.628907 46.054687zm-117.445312-277.5c17.851562-16.574218 42.273437-25.953125 68.222656-25.953125 25.960938 0 50.382812 9.378907 68.222656 25.953125l-42.082031 146.84375c-8.15625-2.980468-16.964844-4.601562-26.140625-4.601562s-17.984375 1.621094-26.140625 4.601562zm-87.496094 387.078125c-23.273438-7.207031-43.566406-23.710937-56.5-46.210937s-16.992188-48.339844-11.515625-72.074219l148.285156-36.703125c3.15625 18.050781 12.644531 33.9375 26.089844 45.28125zm109.105469-168.222656c0-25.710937 20.914062-46.625 46.613281-46.625 25.710938 0 46.621094 20.914063 46.621094 46.625 0 25.699219-20.910156 46.609375-46.621094 46.609375-25.699219.003906-46.613281-20.910156-46.613281-46.609375zm0 0"/></svg></span>
        <span onclick=f2_1(1) class="but" id='fn1'>
            <span class="but-h" >
                <svg width="30%"  viewBox="0 -17 511.99979 511"  xmlns="http://www.w3.org/2000/svg"><path d="m506.078125 308.792969-2.558594-7.90625-48.820312-12.226563c.300781-4.429687.4375-8.875.4375-13.363281 0-56.921875-24.449219-111.230469-67.074219-149.003906l-19.890625 22.441406c36.214844 32.085937 56.976563 78.21875 56.976563 126.5625 0 1.988281-.027344 3.96875-.109376 5.9375l-31.699218-7.9375c-.449219-31.117187-11.523438-61.335937-31.324219-85.328125l-23.132813 19.09375c13.753907 16.652344 22.121094 37.183594 24.0625 58.625l-32.308593-8.085938c-3.488281-14.734374-11.257813-27.839843-21.914063-37.925781l49.121094-171.363281-5.554688-6.167969c-23.8125-26.460937-58.878906-41.644531-96.195312-41.644531s-72.371094 15.183594-96.183594 41.644531l-5.558594 6.167969 13.847657 48.320312c-10.867188 5.367188-21.304688 11.765626-31.199219 19.171876-33.4375 25-58.648438 60.628906-70.992188 100.304687l28.636719 8.90625c13.625-43.824219 43.542969-78.78125 81.941407-99.125l9.054687 31.609375c-11.796875 7.058594-22.589844 15.902344-31.925781 26.351562l22.359375 19.980469c5.476562-6.128906 11.597656-11.554687 18.203125-16.195312l9.1875 32.050781c-10.597656 10.035156-18.34375 23.058594-21.851563 37.703125l-32.339843 8.007813c1.109374-12.382813 4.339843-24.320313 9.648437-35.617188l-27.152344-12.742188c-8.253906 17.589844-12.601562 36.382813-12.921875 55.886719l-110.238281 27.289063-2.582031 7.898437c-11.074219 33.835938-6.753906 71.792969 11.847656 104.148438 18.601562 32.347656 49.230469 55.179687 84.039062 62.636719l8.125 1.738281 35.039063-36.132813c32.636719 21.949219 71.230469 33.824219 111.015625 33.824219 13.734375 0 27.449219-1.398437 40.773438-4.175781l-6.117188-29.359375c-11.316406 2.359375-22.96875 3.546875-34.65625 3.546875-32.6875 0-63.527344-9.433594-89.675781-25.859375l22.691406-23.402344c19.824219 11.136719 42.675781 17.484375 66.984375 17.484375v-29.988281c-16.132812 0-31.4375-3.578125-45.171875-9.996094l23.171875-23.910156c6.964844 2.097656 14.351562 3.226562 22 3.226562 7.578125 0 14.894531-1.097656 21.8125-3.167969l123.703125 128.300782 8.125-1.71875c34.828125-7.355469 65.527344-30.109375 84.210937-62.40625 18.691407-32.296875 23.109376-70.242188 12.132813-104.109375zm-200.761719 25.148437c13.464844-11.3125 23-27.167968 26.207032-45.203125l148.175781 37.097657c5.40625 23.75 1.289062 49.582031-11.707031 72.050781-13.003907 22.464843-33.335938 38.90625-56.628907 46.054687zm-117.445312-277.5c17.851562-16.574218 42.273437-25.953125 68.222656-25.953125 25.960938 0 50.382812 9.378907 68.222656 25.953125l-42.082031 146.84375c-8.15625-2.980468-16.964844-4.601562-26.140625-4.601562s-17.984375 1.621094-26.140625 4.601562zm-87.496094 387.078125c-23.273438-7.207031-43.566406-23.710937-56.5-46.210937s-16.992188-48.339844-11.515625-72.074219l148.285156-36.703125c3.15625 18.050781 12.644531 33.9375 26.089844 45.28125zm109.105469-168.222656c0-25.710937 20.914062-46.625 46.613281-46.625 25.710938 0 46.621094 20.914063 46.621094 46.625 0 25.699219-20.910156 46.609375-46.621094 46.609375-25.699219.003906-46.613281-20.910156-46.613281-46.609375zm0 0"/></svg>
                <svg  width="30%" viewBox="0 -17 511.99979 511"  xmlns="http://www.w3.org/2000/svg"><path d="m506.078125 308.792969-2.558594-7.90625-48.820312-12.226563c.300781-4.429687.4375-8.875.4375-13.363281 0-56.921875-24.449219-111.230469-67.074219-149.003906l-19.890625 22.441406c36.214844 32.085937 56.976563 78.21875 56.976563 126.5625 0 1.988281-.027344 3.96875-.109376 5.9375l-31.699218-7.9375c-.449219-31.117187-11.523438-61.335937-31.324219-85.328125l-23.132813 19.09375c13.753907 16.652344 22.121094 37.183594 24.0625 58.625l-32.308593-8.085938c-3.488281-14.734374-11.257813-27.839843-21.914063-37.925781l49.121094-171.363281-5.554688-6.167969c-23.8125-26.460937-58.878906-41.644531-96.195312-41.644531s-72.371094 15.183594-96.183594 41.644531l-5.558594 6.167969 13.847657 48.320312c-10.867188 5.367188-21.304688 11.765626-31.199219 19.171876-33.4375 25-58.648438 60.628906-70.992188 100.304687l28.636719 8.90625c13.625-43.824219 43.542969-78.78125 81.941407-99.125l9.054687 31.609375c-11.796875 7.058594-22.589844 15.902344-31.925781 26.351562l22.359375 19.980469c5.476562-6.128906 11.597656-11.554687 18.203125-16.195312l9.1875 32.050781c-10.597656 10.035156-18.34375 23.058594-21.851563 37.703125l-32.339843 8.007813c1.109374-12.382813 4.339843-24.320313 9.648437-35.617188l-27.152344-12.742188c-8.253906 17.589844-12.601562 36.382813-12.921875 55.886719l-110.238281 27.289063-2.582031 7.898437c-11.074219 33.835938-6.753906 71.792969 11.847656 104.148438 18.601562 32.347656 49.230469 55.179687 84.039062 62.636719l8.125 1.738281 35.039063-36.132813c32.636719 21.949219 71.230469 33.824219 111.015625 33.824219 13.734375 0 27.449219-1.398437 40.773438-4.175781l-6.117188-29.359375c-11.316406 2.359375-22.96875 3.546875-34.65625 3.546875-32.6875 0-63.527344-9.433594-89.675781-25.859375l22.691406-23.402344c19.824219 11.136719 42.675781 17.484375 66.984375 17.484375v-29.988281c-16.132812 0-31.4375-3.578125-45.171875-9.996094l23.171875-23.910156c6.964844 2.097656 14.351562 3.226562 22 3.226562 7.578125 0 14.894531-1.097656 21.8125-3.167969l123.703125 128.300782 8.125-1.71875c34.828125-7.355469 65.527344-30.109375 84.210937-62.40625 18.691407-32.296875 23.109376-70.242188 12.132813-104.109375zm-200.761719 25.148437c13.464844-11.3125 23-27.167968 26.207032-45.203125l148.175781 37.097657c5.40625 23.75 1.289062 49.582031-11.707031 72.050781-13.003907 22.464843-33.335938 38.90625-56.628907 46.054687zm-117.445312-277.5c17.851562-16.574218 42.273437-25.953125 68.222656-25.953125 25.960938 0 50.382812 9.378907 68.222656 25.953125l-42.082031 146.84375c-8.15625-2.980468-16.964844-4.601562-26.140625-4.601562s-17.984375 1.621094-26.140625 4.601562zm-87.496094 387.078125c-23.273438-7.207031-43.566406-23.710937-56.5-46.210937s-16.992188-48.339844-11.515625-72.074219l148.285156-36.703125c3.15625 18.050781 12.644531 33.9375 26.089844 45.28125zm109.105469-168.222656c0-25.710937 20.914062-46.625 46.613281-46.625 25.710938 0 46.621094 20.914063 46.621094 46.625 0 25.699219-20.910156 46.609375-46.621094 46.609375-25.699219.003906-46.613281-20.910156-46.613281-46.609375zm0 0"/></svg>
            </span>
        </span>
        <span onclick=f2_1(2) class="but" id='fn2'>
            <svg width="40%" viewBox="0 -17 511.99979 511"  xmlns="http://www.w3.org/2000/svg"><path d="m506.078125 308.792969-2.558594-7.90625-48.820312-12.226563c.300781-4.429687.4375-8.875.4375-13.363281 0-56.921875-24.449219-111.230469-67.074219-149.003906l-19.890625 22.441406c36.214844 32.085937 56.976563 78.21875 56.976563 126.5625 0 1.988281-.027344 3.96875-.109376 5.9375l-31.699218-7.9375c-.449219-31.117187-11.523438-61.335937-31.324219-85.328125l-23.132813 19.09375c13.753907 16.652344 22.121094 37.183594 24.0625 58.625l-32.308593-8.085938c-3.488281-14.734374-11.257813-27.839843-21.914063-37.925781l49.121094-171.363281-5.554688-6.167969c-23.8125-26.460937-58.878906-41.644531-96.195312-41.644531s-72.371094 15.183594-96.183594 41.644531l-5.558594 6.167969 13.847657 48.320312c-10.867188 5.367188-21.304688 11.765626-31.199219 19.171876-33.4375 25-58.648438 60.628906-70.992188 100.304687l28.636719 8.90625c13.625-43.824219 43.542969-78.78125 81.941407-99.125l9.054687 31.609375c-11.796875 7.058594-22.589844 15.902344-31.925781 26.351562l22.359375 19.980469c5.476562-6.128906 11.597656-11.554687 18.203125-16.195312l9.1875 32.050781c-10.597656 10.035156-18.34375 23.058594-21.851563 37.703125l-32.339843 8.007813c1.109374-12.382813 4.339843-24.320313 9.648437-35.617188l-27.152344-12.742188c-8.253906 17.589844-12.601562 36.382813-12.921875 55.886719l-110.238281 27.289063-2.582031 7.898437c-11.074219 33.835938-6.753906 71.792969 11.847656 104.148438 18.601562 32.347656 49.230469 55.179687 84.039062 62.636719l8.125 1.738281 35.039063-36.132813c32.636719 21.949219 71.230469 33.824219 111.015625 33.824219 13.734375 0 27.449219-1.398437 40.773438-4.175781l-6.117188-29.359375c-11.316406 2.359375-22.96875 3.546875-34.65625 3.546875-32.6875 0-63.527344-9.433594-89.675781-25.859375l22.691406-23.402344c19.824219 11.136719 42.675781 17.484375 66.984375 17.484375v-29.988281c-16.132812 0-31.4375-3.578125-45.171875-9.996094l23.171875-23.910156c6.964844 2.097656 14.351562 3.226562 22 3.226562 7.578125 0 14.894531-1.097656 21.8125-3.167969l123.703125 128.300782 8.125-1.71875c34.828125-7.355469 65.527344-30.109375 84.210937-62.40625 18.691407-32.296875 23.109376-70.242188 12.132813-104.109375zm-200.761719 25.148437c13.464844-11.3125 23-27.167968 26.207032-45.203125l148.175781 37.097657c5.40625 23.75 1.289062 49.582031-11.707031 72.050781-13.003907 22.464843-33.335938 38.90625-56.628907 46.054687zm-117.445312-277.5c17.851562-16.574218 42.273437-25.953125 68.222656-25.953125 25.960938 0 50.382812 9.378907 68.222656 25.953125l-42.082031 146.84375c-8.15625-2.980468-16.964844-4.601562-26.140625-4.601562s-17.984375 1.621094-26.140625 4.601562zm-87.496094 387.078125c-23.273438-7.207031-43.566406-23.710937-56.5-46.210937s-16.992188-48.339844-11.515625-72.074219l148.285156-36.703125c3.15625 18.050781 12.644531 33.9375 26.089844 45.28125zm109.105469-168.222656c0-25.710937 20.914062-46.625 46.613281-46.625 25.710938 0 46.621094 20.914063 46.621094 46.625 0 25.699219-20.910156 46.609375-46.621094 46.609375-25.699219.003906-46.613281-20.910156-46.613281-46.609375zm0 0"/></svg></span>
    </div>
</div>
   
<script type="text/javascript">

    const Y = f => ( h => h(h) ) ( g => f( x => g(g)(x) ) );

    class Chain {
        constructor(obj){
            this.run = obj;
            this.map = f => new Chain(f(this.run))
            this.tap = f => ( (_) => this )( f(this.run) )
    }}

    class Eather {
        static tryCatcher = f => { try { return new Eather( f() ) } catch (err){ return  new Eather( undefined, err) ; } }
        constructor(obj, left = undefined ){
            this.rgh = left === undefined ? obj : undefined;
            this.lft = left;
            this.ret = x => new Eather(x);
            this.bnd = fk => this.lft === undefined ? fk(this.rgh) : this ;
            this.map = f => this.bnd( (x) => this.ret( f(x) ) ) ;                   //this.lft === undefined ? new Eather( f(this.rgh) ) : this 
            this.tap = f => this.bnd( (x) => ((_) => this) (f(x))    ) ;
            this.mapTry = f => this.bnd( (x) => Eather.tryCatcher( () => f(x) ) ) ;
            this.tapTry = f => this.bnd( (x) => Eather.tryCatcher( () => ( ((_) => x )( f(x) ) )  ) ) ;
            this.run = this.lft === undefined ? [this.rgh,undefined] : [undefined,this.lft] ;  
            this.runRgh = ( def ) =>  this.lft === undefined ? this.rgh : def;
    }}

    const e = new Eather(2).mapTry( x => { throw "Error2" } ).runRgh(1111111)

    //console.log( )

    console.log(e)  ;      


    const arr = (x) => ((n) => x )

     //data Reader r a = Reader {  runReader :: r -> a }
    class Reader{
        constructor(e2objFun){
            this.run = e2objFun
            this.ret = (x) => new Reader( (_) => x )
            this.map = f => new Reader( e => f( e2objFun(e)) ) 
            this.bnd = fk => new Reader( (e) =>  fk( this.run(e) ).run(e) ) 
        }
    }
    //data Writer w a = Writer { runWriter :: (a, w) }
    class Writer{
        constructor(aw, mapendF = x=>x  , memptyV = '' ){
            this.mapend = mapendF
            this.mempty = memptyV
            this.run = aw
            this.ret = (x) => new Writer( [x,this.mempty] , this.mapend, this.mempty )
            this.bnd = fk => (  nw => new Writer(   
                (nwr => [ nwr[0], this.mapend ( this.run[1], nwr[1]) ] )(nw.run) 
                , this.mapend
                , this.mempty  
                )) ( fk( this.run[0] ) )
     
            //this.bnd = fk => ( nw => new Writer( [ nw.run[0], nw.mapend ( this.run[1],nw.run[1]) ], nw.mapend, nw.mempty  )) ( fk( this.run[0] ) )
            this.put = fw => this.bnd( (x) => new Writer( [x, fw(x)], this.mapend, this.mempty  ) )
            this.map = f  => this.bnd( (x) => new Writer( [f(x), this.mempty ], this.mapend, this.mempty  ) )
            //new Writer( [ this.un[0] , fw(this.run[0])] , this.mapend, this.mempty)
            //this.tap = f => this.bnd( (x) => ((_) => this) (f(x))    ) ;
            //this.tap = f => new Writer( [f(this.run[0]), this.run[1]], this.mapend  ) 
            //this.map = f => new Writer( [f(this.run[0]), this.run[1]], this.mapend  ) 
            //this.bnd = fk => ( nw => new Writer( [ nw.run[0], nw.mapend ( this.run[1],nw.run[1]) ], nw.mapend )) ( fk( this.run[0] ) )
        }
    }



    //s -> [a, s]
    //State s a = State { runState :: s -> (a, s) } 
    class State{
        constructor(e2objFW, mapendF = (o1,o2) => ({ ...o1,...o2 }) ){
            this.mapend = mapendF
            this.run = e2objFW
            this.ret = (s) => new State( (_) =>  [ x, undefined ], this.mapend );
            this.map = f   => new State( (e) => [ f(this.run(e)[0]) , this.run(e)[1] ] , this.mapend  ); //new State( [(e) => f( this.run[0](e) ) , this.run[1] ] , this.mapend  );
            this.bnd = fk  => 
                ( ns => new State( (e) => [ ns(e).run(e)[0] , ns(e).mapend( this.run(e)[1], ns(e).run(e)[1] ) ], this.mapend ) ) 
                    ( (e) =>  fk( this.run(e)[0] ) );
            this.tap = (f) => new State( e => ( ( xs => [f(xs[0]),xs] [1] ) ( this.run(e) ) ) )
            // fxe : (x , e) => 
            this.bnd2 = (fxe) => this.bnd( x => new State( (e) => fxe(x,e)  )  );                                       //  (a , e) => Sb : e -> [b,e]
            this.get2 = (fxe) => this.bnd( x => new State( (e) => [ fxe(x,e), ({}) ] )  );                              //  (a , e) =>            b  
            this.put2 = (fxe) => this.bnd( x => new State( (e) => [ this.run(e)[0], fxe(x,this.run(e)[1]) ] )  );       //  (a , e) =>              e  
            this.tap2 = (fxe) => new State( e => ( ( xs => { fxe(xs[0], xs[1] );  return xs;} ) ( this.run(e) ) ) );    //  (a , e) =>                

        }
    } 
 
    // //s -> [a, s -> s]
    // class State{
    //     constructor(e2objFW ){
    //         this.run = e2objFW
    //         this.ret = (s) => new State( (_) =>  [ x, undefined ] );
    //         this.map = f   => new State( (e) => [ f(this.run(e)[0]) , this.run(e)[1] ] ); //new State( [(e) => f( this.run[0](e) ) , this.run[1] ] , this.mapend  );
    //         this.bnd = fk  => 
    //             ( ns => new State( (e) => [ ns(e).run(e)[0] , ns(e).mapend( this.run(e)[1], ns(e).run(e)[1] ) ], this.mapend ) ) 
    //                 ( (e) =>  fk( this.run(e)[0] ) );
    //     }    
    // } 

    const oMpnd = (o1,o2) => ({ ...o1,...o2 })

    const s = new State( e => [ 1 , e ]  )
                .map( x => x+100 )
                .map( x => x+100 )
                .bnd( x => new State( e => [ x+333 , ({aaa:"ssss"}) ]  ) )
                .bnd( x => new State( e => [ x+333 , ({aaw:"ssss"}) ]  ) )
                .bnd2( (x , e) => [ x+333 , ({aee:"ssss"}) ] )
                .get2( (x , e) => x + 1000  )
                .put2( (x , e) =>  ({aeevv:"ssss"})  )
                //.map( x => x+100 )
                .run(({}))

    console.log(s);


    //    new Reader( e => e[1] + 5  )
    //         .map( x => x + 2)
    //         .map( x => x + 2)
    //         .bnd( x => new Reader( (e) => { console.log(e) ; console.log(x) ; return x + e[2] ;})  )
    //         .map( x => console.log(x) )
    //         .run ([1,2,300])
    
    //new Writer([1,[]] , (a1,a2) => a1.concat(a2) )
    // const cnct = (a1,a2) => a1.concat(a2) 
    // console.log( 
    //     new Writer([1,[]] , cnct , [] )
    //         //.map(x=>x+2)  
    //         .bnd(x =>  new Writer( [x+100, ["rertt"]]    ))  
    //         .bnd(x =>  new Writer( [x+100, ["22222",'sss']]  ) ) 
    //         .put(x => ["a"+x])
    //         .map(x => x+22222222)
    //         .map(x => x+23332222222)
    //         //.map( x => console.log(x))      
    //         .run
    //     )

    //new Chain(1).map(x=>console.log(x));

    const httpGetAsJsonEth = (theUrl) => new Eather(new XMLHttpRequest())
        .tap( x=> console.log(x))
        .tapTry( x=>x.open( "GET", theUrl, false ))
        .tapTry( x=> console.log(x))
        .tapTry( x=>x.send( null ))
        .mapTry( x=>JSON.parse(x.responseText))
        
        

    const httpGetAsJson = (theUrl) => new Chain(new XMLHttpRequest())
        .tap( x=>console.log(theUrl)) 
        .tap( x=>x.open( "GET", theUrl, false ))
        .tap( x=>x.send( null ))
        .map( x=>JSON.parse(x.responseText))
        .run


    const getOfset=( dateStr, d2) => new Date(
            dateStr.substr(0,4),
            dateStr.substr(5,2),
            dateStr.substr(8,2),
            dateStr.substr(11,2),
            dateStr.substr(14,2),
            dateStr.substr(17,2)
            ).getTime() - d2.getTime();

      
    const safeGetOfset = (theUrl, prop) => httpGetAsJsonEth(theUrl)
        .map( x => x[prop] )
        .map( x => getOfset(x, new Date() ) )
        .runRgh(100)
        
    
    //getOfset(  httpGetAsJson(theUrl)[prop]  , new Date())
   
    const getTimeByUriFun = (theUrl, prop) => ( offset ) =>  offset 
        ? ( () =>  new Date( new Date().getTime() + offset ) )       
        : getTimeByUriFun( theUrl, prop ) ( safeGetOfset(theUrl,prop) )  ;  
            
    const draw = (ctx, drawFunc, setOptFunc = (c) => { c.strokeStyle = "#fff"; c.lineWidth = 1;}) => 
        ((_) => drawFunc(ctx) ) ( setOptFunc(ctx) )   

    const drawPathFunc = ( drPathFunc ) => 
        (c) => new Chain(c)
            .tap( c => c.beginPath() ) 
            .tap( c => drPathFunc(c) ) 
            .tap( c =>c.stroke())
            .run
    
   
    const drawPathByPointsFunc = ( pointPairs ) => 
            drawPathFunc( 
                (ctx) => pointPairs.forEach( (v,i) => ( i==0 ? (x,y)=>ctx.moveTo(x,y) : (x,y) => ctx.lineTo(x,y) ) ( v[0], v[1] ) ) 
            )

    const drawText = ( text, x, y , isOutl = false ) => 
            (c) => new Chain(c)
                .tap( c => isOutl ? c.strokeText(text ,x , y) : undefined  )
                .tap( c => c.fillText( text ,x, y )  )

   

    const drawTextClntSetOpt = (size, clr , isOutl = false ) => (ctx) => { 
            ctx.font = size.toString() + 'px arial'; 
            ctx.fillStyle = clr; 
            if(isOutl){
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 5;
            }
        } ;
    
                    
    const draws = ( ctx, drawAndOftFuncs) => {
        //console.log(drawAndOftFuncs);
        return drawAndOftFuncs.forEach( e => draw(ctx, e[0], e[1]) )
    }


    //-------------------------------------------------------
    const initState = () =>({
        canvasId:"testCanvas",
        sizeDivId:"cvDiv",
        url:"http://back.nvavia.ru/api/webinstance/gettime",
        PROP_TM:"datetime",
    });

    //    +-----------------+---+
    //    |                 |   |
    //    +-----------------+---+
    const stateInitLayout = ( state, width, height ) => ({ ...state, ...stateInitByLayout( width, height)  })

    const stateInitByLayout = ( width, height, time = undefined ) => ({ 
        width:width,
        height:height,
        wth:{
            time:time,
            url:"https://api.open-meteo.com/v1/forecast?latitude=60.95&longitude=76.50&hourly=temperature_2m&timezone=auto",
            PROP_HR:'hourly',
            PROP_TH:'temperature_2m',
            PROP_TM:"time",
            xofst:0,
            yofst:0,
            width:width-height,
            height:height,
            clientPad:15,
            axTxtClr:'#fff',
            axYGrade:5,
            grphClr:'#99f',
            grphWidth:3,
            tColor:'#e00',
            xAxeColor:"#0f0",
            xAxeWidth:1,
        },
        clc:{
            time:time,
            xofst:width-height,
            yofst:0,
            width:height,
            height:height,
            grades: 12,
            isShowRound:true, 
            isShowSec:true, 
            isArrTail:true, 
            lineCap:"round",
            color1:"#f00", 
            color2:"#f55"
        }
    });

    const ststeInitClock = (state) => ({...state,
        timeFunc: getTimeByUriFun(state.url, state.PROP_TM)(0) , 
    })

    //old
    const stateInitParsClc = ( state ) => ({ ...state,
        timeFunc: getTimeByUriFun(state.url, state.PROP_TM)(0) , 
        clientPad: state.width/15,          //?? 15,
        hArrPad:state.width/5,              //?? 15,
        mArrPad:state.width/10,             //?? 15,
        sArrPad:state.width/15,             //?? 15,¬
        grades: 0,
        gradeLen: state.width/15,          // ?? 15, 
        isShowRound:true, 
        isShowSec:true, 
        isArrTail:false, 
        lineCap:"round",
        color1:"#f00", 
        color2:"#f55"
    });

    const stateInitClcLayout = ( state ) => ({
        clientPad: state.width/15,          //?? 15,
        hArrPad:state.width/5,              //?? 15,
        mArrPad:state.width/10,             //?? 15,
        sArrPad:state.width/15,             //?? 15,¬
        gradeLen: state.width/15,          // ?? 15, 
    });

    // Init Clock helper funs  to state
    const stateInitClcTools = (state) => ({
        toX: (x) =>    state.xofst + state.clientPad + x ,
        toY: (y) =>  ( state.yofst + state.clientPad + y ) ,
        wth: (n) => n  < 1 ? 1 : n ,
        xp: (l,m) => l * Math.sin( Math.PI*m/30), 
        yp: (l,m) => - l * Math.cos( Math.PI*m/30), 
        hr2mn: (h,m) => ((h>11?h-12:h)*60+m) / 12 , 
    })
    const stateInitClcToolsBis = (state) => ({
        toXYs: (pss) => pss.map((ps) => [state.toX(ps[0]), state.toY(ps[1])]),
    })

    const drawClcRound = (state, clr, wth) =>  [
        drawPathFunc( 
            cx => cx.arc( 
                state.toX( state.width/2-state.clientPad ), 
                state.toY( state.width/2-state.clientPad ), 
                state.width/2-state.clientPad , 0, 2 * Math.PI, false
            )
        ),
        cx => { cx.strokeStyle =  clr;  cx.lineWidth = state.wth(wth);  }
    ] 

    const drawClcGrade = (state , ang ,  bLen , eLen , width, clr ) =>  [       
            (   (cntr) => drawPathByPointsFunc(  state.toXYs([ 
                    [cntr + state.xp(bLen,ang ) , cntr + state.yp(bLen, ang)],  
                    [cntr + state.xp(eLen,ang ) , cntr + state.yp(eLen, ang)]  
                ]) )
            )(  state.width/2 -  state.clientPad  ),
            c => { c.strokeStyle = clr;  c.lineWidth = width; c.lineCap = state.lineCap;  } 
        ] ;

    const drawClcGrades = (_state) => 
        [...Array( _state.grades ).keys()]
            .map( x => x * 60/_state.grades )
                .reduce( (writer,ang) =>
                    writer
                        .put( state => [drawClcGrade(
                            state, ang, state.width/2 - state.clientPad - state.gradeLen, state.width/2 - state.clientPad, state.width/15, state.color1  
                        )]) 
                        .put( state => [drawClcGrade(
                            state, ang, state.width/2 - state.clientPad - state.gradeLen, state.width/2 - state.clientPad, state.width/45, state.color2  
                        )]) 
                    , new Writer([_state, []] , (a1,a2) => a1.concat(a2), [] )
                );

    const drawClcArrowPart = ( _state, ang, pad, width, clr ) => 
        new Writer([_state, []] , (a1,a2) => a1.concat(a2), [] )
            .put( state => [ drawClcGrade(state , ang ,  0 , state.width/2 - pad , width, clr ) ] )
            .put( state => state.isArrTail ? [ drawClcGrade(state, (ang>29 ? ang-30 : ang + 30) , state.width/4 - pad , 0 , width, clr ) ] : [] )

    const drawClcArrow = ( _state, ang, pad, width) => 
        new Writer([_state, []] , (a1,a2) => a1.concat(a2), [] )
            .put( state =>  drawClcArrowPart(state, ang, pad, width, state.color1).run[1]  )
            .put( state =>  drawClcArrowPart(state, ang, pad, width/3, state.color2).run[1]  )

    const drawClcArrows = (_state) => 
        new Writer( [_state, [] ], (a1,a2) => a1.concat(a2), [] )
            .bnd( state =>  drawClcArrow(state, state.hr2mn(state.time.getHours(),state.time.getMinutes()) , state.hArrPad , state.width/15 ) )
            .bnd( state =>  drawClcArrow(state, state.time.getMinutes() , state.mArrPad , state.width/20 )  )
            .bnd( state =>  state.isShowSec ? drawClcArrow(state, state.time.getSeconds() , state.sArrPad , state.width/60 ) : [] )

         
    const drawClc = (state) => new Writer( [state, [] ], (a1,a2) => a1.concat(a2), [] )
        .put( state => [drawClcRound(state,state.color1,state.width/15 )]  )   
        .put( state => [drawClcRound(state,state.color2,state.width/45 )]  )  
        .bnd( state => drawClcGrades(state))
        .bnd( state => drawClcArrows(state))

    //Clock Draw     
    const drawClock = (clcState, ctx ) => new State(st => [ ctx , st ])
        .put2( (c,state) => stateInitClcLayout(state))
        .put2( (c,state) => stateInitClcTools(state))
        .put2( (c,state) => stateInitClcToolsBis(state))
        .tap2( (c,state) => c.clearRect( state.xofst, state.yofst, state.width, state.height ))
        .tap2( (c,state) => draws(c, drawClc(state).run[1]))
        .run( clcState )

    // Temperature Draw

    const stroke = (wdh,clr) => c => { c.strokeStyle = clr;  c.lineWidth = wdh;  } ;

    const stateInitWthLayout = (state) => ({

            clWidth:  state.width - state.clientPad*2, 
            clHeight: state.height - state.clientPad*2,
            cyrTimesInd: state.days,
            minY: (Math.floor( Math.min( ...(state.data) )/5)) * 5,
            maxY: (Math.floor( Math.max( ...(state.data) )/5)+1) * 5, 
            toX: (x) => state.xofst + state.clientPad + x ,
            toY: (y) => state.height - ( state.yofst + state.clientPad + y ) ,
    });

    const stateInitWthLayoutBis = (state) => ({            
        toXYs:  (pss) =>  pss.map((ps) => [state.toX(ps[0]), state.toY(ps[1])]),
        tmpToY: (tmp) =>  (tmp - state.minY) * state.clHeight / state.tmpHeight ,
        idxToX: (idx) =>  idx * state.clWidth / state.data.length ,
    });

    const drawWthLineW = ( state, pointPairs,  wth, clr ) => new Writer(  [state, []], (a1,a2) => a1.concat(a2), [] ) 
        .put( state => [ drawPathByPointsFunc(state.toXYs(pointPairs)) , stroke( wth, clr ) ]  ) //c => { c.strokeStyle = "#fff";  c.lineWidth = 1;  }  ]) // stroke( wth, clr ) ]  )

    const drawWthXAxeW = (state, y ) => drawWthLineW ( state,  [[0, y],[state.clWidth, y]], state.xAxeWidth, state.xAxeColor )

    //const drawWthXAxesW = ( state ) => new Writer(  [state, []], (a1,a2) => a1.concat(a2), [] ) 
    //    .put( state =>  )
       

    //const drawXAxeWithTxt = ( state, tmp ) => new Writer(  [state, []], (a1,a2) => a1.concat(a2), [] )
    //    .bnd( (state) => [ drawXAxeFun( state.tmpToY(tmp) ), stroke( )] )
    //   .put(  )
    
    
    // [ 
    //             [drawXAxeFun(tmpToY(tmp)),  c => { c.strokeStyle = "#fff";  c.lineWidth = 1;  }],
    //             drawTextFuns( tmp.toString(), -state.clientPad ,tmpToY(tmp) - state.clHeight/11/2 , state.clHeight/11 , state.axTxtClr),
    //             drawTextFuns( tmp.toString(), state.clWidth ,tmpToY(tmp) - state.clHeight/11/2 , state.clHeight/11 , state.axTxtClr)
    //     ]    

    const drawXAxes = ( tmp , writer) => writer
        .put( state => tmp > Math.abs(state.maxY) ? [] :  drawXAxeWithTxt(tmp).concat(  drawXAxes(tmp + state.axYGrade, writer ) )) 
    
    
    
    //new Writer(  [state, []], (a1,a2) => a1.concat(a2), [] )
        // ( tmp > Math.abs(state.maxY) ) 
        //     ? acc 
        //     : drawXAxes ( tmp + state.axYGrade , acc.concat( drawXAxeWithTxt(tmp) ) );

    const drawWeather = (clcState, ctx ) => new Eather(clcState )
        .bnd( state => httpGetAsJsonEth(state.url).mapTry( d => ({state:state, data:d[state.PROP_HR]  })) )
        .bnd( dts => {
            console.log(dts)    
            return new State( st => [ ctx , st ] ) 
                //.put2( (c,state) => ({  data: dts.data[state.PROP_TH],  days: dts.data[state.PROP_TM] }) )
                .put2( (c,state) => ({  data: dts.data[state.PROP_TH],  days: dts.data[state.PROP_TM] }) )
                //.put2( (c,state) =>{ console.log(state) ; return  ({}) })
                .put2( (c,state) => stateInitWthLayout (state) )
                //.put2( (c,state) =>{ console.log(state) ; return  ({}) })
                .put2( (c,state) => stateInitWthLayoutBis(state) )
                .put2( (c,state) =>{ console.log( state ); return  ({}) })
                //.put2( (c,state) =>{ console.log( [ drawXAxeFun(state, 10).run[1] ] ) ; return  ({}) })
                .tap2( (c,state) => draws(c,[drawXAxeFun(state, 30).run[1]]))
                .run( dts.state );
            }     
        )
        .run

    
    const bang = ( initSt ) => new State( st => [ 1 , st ] )
        //.bnd(  x => new State( e => [ x+333 , ({wrw:"ss"}) ]  )  )
        .get2( (_,state) => document.getElementById( state.canvasId )  )
        .tap2( (c,state) => c.width = document.getElementById("cvDiv").clientWidth )
        .tap2( (c,state) => c.height = document.getElementById(state.sizeDivId).clientHeight )
        .put2( (c,state) => stateInitByLayout(c.width, c.height, getTimeByUriFun(state.url, state.PROP_TM)(0)() ) )
        .map( c => c.getContext( "2d" ) )
        .tap2( (c,state) => console.log(state))
        .tap2( (c,state) => drawClock(state.clc,c))
        .tap2( (c,state) => drawWeather(state.wth,c))

        .run( initSt )

    //console.log(initState);
    console.log( bang( initState() ) )    ;

    //    .tap( x => x.width = .getElementById( state.canvasId )  )


    //     (x,state) => x.document.getElementById( state.canvasId )  )
    //     .get( (x,state) => document.getElementById( state.canvasId )  )
    //     .put( (x,state) =>   )
        




    //draw all 
    function drawLayout( state ){
        const canvas = document.getElementById( state.canvasId );
        canvas.width = document.getElementById(state.sizeDivId).clientWidth ;
        canvas.height = document.getElementById(state.sizeDivId).clientHeight;
        state = stateInitLayout(state , canvas.width, canvas.height);
        const context = canvas.getContext( "2d" );

        console.log('stateInitLayout ' + state);
        console.log(state);
        drawLeft( state.wth, context );
        setInterval(drawLeft, 600000,  state.wth, context );
        //drawRight( stateInitParsClc( state.clc) , context);
        setInterval(drawRight, 1000,  stateInitParsClc( state.clc) , context );
    };

    //draw clock
    function drawRight(state, context ){
        //console.log(state.timeFunc())
        try{
            state = ({...state, time: state.timeFunc() , err:state.timeFunc().toString() })
        }
        catch(e){
            state = ({...state, time:  new Date(), err:e })
        }
        const toX = (x) =>    state.xofst + state.clientPad + x ;
        const toY = (y) =>  ( state.yofst + state.clientPad + y ) ; //state.height -
        const toXYs = (pss) => pss.map((ps) => [toX(ps[0]), toY(ps[1])]);

        const wth = (n) => n  < 1 ? 1 : n ;
        const np = (l,m,f) => l * f( Math.PI*m/30); 
        const xp = (l,m) => np( l, m, Math.sin );
        const yp = (l,m) => - np( l, m, Math.cos );
        const hr2mn = (h,m) => ((h>11?h-12:h)*60+m) / 12

        const drTextClnt = ( text, x, y , isOutl = false ) => drawText( text, toX(x) , toY(y) , isOutl)

        const drawGrade = ( m, cntr, bLen , eLen , width, clr, lCap) =>  [   
            drawPathByPointsFunc(  toXYs([ 
                    [cntr + xp(bLen,m ) , cntr + yp(bLen, m)],  
                    [cntr + xp(eLen,m ) , cntr + yp(eLen, m)]  
                ]) ),
            c => { c.strokeStyle = clr;  c.lineWidth = width; c.lineCap = lCap;  } 
        ] ;  

        const drawArrow = ( m, cntr, pad,  width , clr, isTail, lCap ) => 
            [drawGrade( m, cntr, 0 , cntr - pad, width, clr, lCap  )]
                .concat( isTail ?  [drawGrade( (m>29 ? m-30 : m + 30), cntr, 0 , (cntr/2) - pad, width, clr, lCap ) ]: [])//(cntr/2) - pad

        const drawRoundFun = (centr, radius) =>  drawPathFunc( (c) => c.arc( toX(centr) , toY(centr), radius, 0, 2 * Math.PI, false) );

        const drawRound = (width, pad, clr, wdh) =>  [[
            drawRoundFun( width/2 - pad , width/2 - pad ), 
            c => { c.strokeStyle = clr;  c.lineWidth = wdh;  }
        ]]
        
        const drawGrages = (count, width, pad, gradelen,cl1,cl2,lCap) =>
            [...Array(count ).keys()]
                .map( x => x * 60/count )
                .reduce( (a,e) => a.concat([
                            drawGrade( e, width/2- pad, width/2 - pad - gradelen, width/2 - pad , wth(width/15) , cl1,lCap),
                            drawGrade( e, width/2- pad, width/2 - pad - gradelen, width/2 - pad , wth(width/45) , cl2,lCap)
                        ]),[]
                );

        context.clearRect( state.xofst, state.yofst, state.width, state.height ); 
        draws(
            context,
            drawRound( state.width, state.clientPad,state.color1, wth(state.width/15) )
                .concat( drawRound( state.width, state.clientPad,state.color2, wth(state.width/45)  ))
                .concat( drawGrages(state.grades,state.width, state.clientPad, state.gradeLen, state.color1, state.color2, state.lineCap) )
                .concat(
                    [
                        [hr2mn(state.time.getHours(),state.time.getMinutes()),state.hArrPad,wth(state.width/15)],
                        [state.time.getMinutes(),state.mArrPad,wth(state.width/20)],
                        
                    ].concat(
                        state.isShowSec ? [[state.time.getSeconds(),state.sArrPad,wth(state.width/60)]]:[]
                    ).reduce(
                        (a,pars) => a.concat( 
                            drawArrow( 
                                pars[0], state.width/2-state.clientPad, pars[1], pars[2], state.color1, state.isArrTail, state.lineCap 
                            ).concat(
                                drawArrow( 
                                    pars[0], state.width/2-state.clientPad, pars[1], pars[2]/3, state.color2, state.isArrTail, state.lineCap
                                )
                            )
                        ), []
                    )
                ) 
                // .concat(
                //     [[drawText(state.err, 20,20,false),drawTextClntSetOpt(20,'red')]]
                // )  
        );
        
    }

    //draw temperature graph
    function drawLeft(state, context ){
        const weatherDays= httpGetAsJson(state.url)[state.PROP_HR];
        console.log(weatherDays);

        const cyrTimesIndFun = (dates) => dates.reduce(
                (accumulator, currentValue, currentIndex) =>  new Date(currentValue) <  new Date() ? currentIndex : accumulator , 0 
            ) ;

        state = ({...state , 
            clWidth: state.width - state.clientPad*2, 
            clHeight: state.height - state.clientPad*2,
            cyrTimesInd: cyrTimesIndFun(weatherDays[state.PROP_TM]),
            data: weatherDays[state.PROP_TH],
            days: weatherDays[state.PROP_TM],
            minY: (Math.floor( Math.min( ...(weatherDays[state.PROP_TH]) )/5)) * 5,
            maxY: (Math.floor( Math.max( ...(weatherDays[state.PROP_TH]) )/5)+1) * 5, 
        });

        console.log(state);
        state = ({...state , 
            tmpHeight: Math.abs(state.maxY-state.minY),
            isTmpDispAbove: state.data[state.cyrTimesInd] > (state.minY+state.maxY)/2,
        // mtrWidth:Math.floor(cvHght * KOEF);

        })
    
        const toX = (x) => state.xofst + state.clientPad + x ;
        const toY = (y) => state.height - ( state.yofst + state.clientPad + y ) ;
        //const toXY = (ps) => [toX(ps[0]), toY(ps[1])];
        const toXYs = (pss) => pss.map((ps) => [toX(ps[0]), toY(ps[1])]);

        const tmpToY = (tmp) =>  (tmp - state.minY) * state.clHeight / state.tmpHeight ;
        const idxToX = (idx) =>  idx * state.clWidth / state.data.length ;

        const drLnClnt = ( pointPairs ) => drawPathByPointsFunc(toXYs(pointPairs))
            // drawPathFunc( 
            //     (ctx) => pointPairs.forEach( (v,i) => ( i==0 ? (x,y)=>ctx.moveTo(x,y) : (x,y) => ctx.lineTo(x,y) ) ( toX(v[0]), toY(v[1]) ) ) 
            // )
        //    drawPathByPointsFunc
        const drTextClnt = ( text, x, y , isOutl = false ) => drawText( text, toX(x) , toY(y) , isOutl)
        // ( text, x, y , isOutl = false ) => (ctx) => {
        //     if(isOutl){
        //         ctx.strokeText(text ,toX(x) , toY(y))
        //     }
        //     ctx.fillText( text ,toX(x) , toY(y) );
        // }
        // const drTextClntSetOpt = (size, clr , isOutl = false ) => (ctx) => { 
        //     ctx.font = size.toString() + 'px arial'; 
        //     ctx.fillStyle = clr; 
        //     if(isOutl){
        //         ctx.strokeStyle = 'white';
        //         ctx.lineWidth = 5;
        //     }
        // } ;
        
        const drawXAxeFun = (y) => drLnClnt( [[ 0, y ],[ state.clWidth, y ]] );
        const drawYAxeFun = (x) => drLnClnt( [[ x, 0 ],[ x, state.clHeight ]] );
        //const drawXAxeFun = (y) => drawPathByPointsFunc( toXYs ( [[0, y],[ state.clWidth, y]] ) );
        //const drawYAxeFun = (x) => drawPathByPointsFunc( [[ toX(x), toY(0) ],[ toX(x), toY(state.clHeight) ]] );


        const drawTextFuns =( txt, x, y, size, clr, isOutl = false ) => [drTextClnt(txt, x, y, isOutl),  drawTextClntSetOpt(size, clr, isOutl) ]
        const drawXAxeWithTxt = ( tmp ) => [ 
                [drawXAxeFun(tmpToY(tmp)),  c => { c.strokeStyle = "#fff";  c.lineWidth = 1;  }],
                drawTextFuns( tmp.toString(), -state.clientPad ,tmpToY(tmp) - state.clHeight/11/2 , state.clHeight/11 , state.axTxtClr),
                drawTextFuns( tmp.toString(), state.clWidth ,tmpToY(tmp) - state.clHeight/11/2 , state.clHeight/11 , state.axTxtClr)
        ]
        const drawXAxes = (tmp, acc) =>  
            (tmp > Math.abs(state.maxY)) 
                ? acc  
                : drawXAxes ( tmp + state.axYGrade, acc.concat( drawXAxeWithTxt(tmp) ) );



        const drawGraphPoints = ( temps, clr, wth ) => [[ 
                drLnClnt( temps.map((tmp,i) => [ idxToX(i),tmpToY(tmp) ])  ) ,
                //drawPathByPointsFunc(temps.map((tmp,i) => [ idxToX(i),tmpToY(tmp) ])),
                c => { c.strokeStyle = clr;  c.lineWidth = wth;  }
            ]]   
        
        //((d) => d.getDate()+" "+["Янв","Фвр","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек" ][ d.getMonth()-1])(new Date(dys[i]))  
        const drawDaysAxe = (dys, pad) => 
        dys.reduce(
                (a,e,i) => ( d => d == a[0] ? a : [d,a[1].concat([i])]    ) (new Date(e).getDate()) , 
                [new Date(dys[0]).getDate(),[]] 
            )[1].reduce(  (a, i) => 
                a.concat(
                    [
                        [drawYAxeFun( idxToX(i) ),  c => { c.strokeStyle = "#fff";  c.lineWidth = 1;  }],
                        drawTextFuns(
                            ((d) => d.getDate()+" "+["Янв","Фвр","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек" ][ d.getMonth()-1])(new Date(dys[i]))
                            ,idxToX(i),-pad+3, 10,"#fff" ),
                        drawTextFuns( ["Вс","Пн","Вт","Ср","Чт","Пт","Сб" ][ new Date(dys[i]).getDay()] 
                            ,idxToX(i),state.clHeight+3, 10,
                            new Date(dys[i]).getDay() ? "#fff" : "#faa"
                        )
                    ]
                ),[]
            );
        

        context.clearRect( 0, 0, state.width, state.height );

        draws(
            context,
            drawXAxes(state.minY,[])
            .concat( drawDaysAxe( state.days, state.clientPad) )
            .concat( drawGraphPoints( state.data,  state.grphClr,  state.grphWidth ) )
            .concat( [[drawYAxeFun( idxToX(state.cyrTimesInd) ),  c => { c.strokeStyle = "#f00";  c.lineWidth = 2;  }]])
            .concat( [drawTextFuns(
                    state.data[state.cyrTimesInd]+"°",
                    idxToX(state.cyrTimesInd) + state.clientPad,
                    !state.isTmpDispAbove 
                        ? tmpToY( state.data[state.cyrTimesInd]) + state.clientPad/2 
                        : tmpToY( state.data[state.cyrTimesInd]) - (60 + state.clientPad/2) , 
                    60, state.tColor ,true)
                ] )
        );
    };

   // drawLayout( initState() );

</script>

</body>
</html>
